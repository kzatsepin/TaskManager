# Task Manager API Documentation

## Пользователи

### Создание пользователя
`POST /api/users`
#### Описание:
Создаёт нового пользователя.
#### Логика:
- Проверяет, что email не занят другим пользователем.
- Пароль хешируется перед сохранением в базу данных.
- Генерируется уникальный идентификатор пользователя.
#### Тело запроса (JSON):
```json
{
  "username": "user123",
  "email": "user@example.com",
  "password": "securepassword"
}
```
#### Ответ (JSON):
```json
{
  "id": 1,
  "username": "user123",
  "email": "user@example.com"
}
```

### Получение информации о пользователе
`GET /api/users/{id}`
#### Описание:
Возвращает информацию о пользователе по его ID.
#### Логика:
- Проверяет, существует ли пользователь с таким ID.
- Если пользователь не найден, возвращает 404.
#### Ответ (JSON):
```json
{
  "id": 1,
  "username": "user123",
  "email": "user@example.com"
}
```

---

## Аутентификация

### Вход пользователя
`POST /api/auth/login`
#### Описание:
Авторизует пользователя и выдаёт JWT-токен.
#### Логика:
- Проверяет, существует ли пользователь с указанным email.
- Проверяет соответствие пароля.
- Генерирует JWT-токен с сроком действия и правами доступа.
#### Тело запроса (JSON):
```json
{
  "email": "user@example.com",
  "password": "securepassword"
}
```
#### Ответ (JSON):
```json
{
  "token": "jwt_token_here"
}
```

---

## Задачи

### Создание задачи
`POST /api/tasks`
#### Описание:
Создаёт новую задачу.
#### Логика:
- Проверяет, авторизован ли пользователь.
- Проверяет, что заголовок задачи не пуст.
- Проверяет, что срок выполнения (due_date) имеет корректный формат и не является прошедшей датой.
- Проверяет, не существует ли уже задачи с таким же заголовком у пользователя.
- Сохраняет задачу в базе данных и привязывает её к пользователю.
#### Тело запроса (JSON):
```json
{
  "title": "Завершить проект",
  "description": "Нужно завершить проект до пятницы",
  "priority": "high",
  "due_date": "2025-04-01"
}
```
#### Ответ (JSON):
```json
{
  "id": 101,
  "title": "Завершить проект",
  "description": "Нужно завершить проект до пятницы",
  "priority": "high",
  "status": "pending",
  "due_date": "2025-04-01"
}
```

### Обновление задачи
`PUT /api/tasks/{id}`
#### Описание:
Обновляет существующую задачу по её ID.
#### Логика:
- Проверяет, авторизован ли пользователь и является ли владельцем задачи.
- Обновляет только те поля, которые переданы в запросе.
- Если due_date обновляется, проверяет, что оно не является прошедшей датой.
#### Тело запроса (JSON):
```json
{
  "title": "Закончить тестирование",
  "status": "in_progress"
}
```
#### Ответ (JSON):
```json
{
  "id": 101,
  "title": "Закончить тестирование",
  "status": "in_progress"
}
```

### Удаление задачи
`DELETE /api/tasks/{id}`
#### Описание:
Удаляет задачу по её ID.
#### Логика:
- Проверяет, авторизован ли пользователь и имеет ли он право удалить задачу.
- Если задача не найдена, возвращает 404.
- Удаляет задачу из базы данных.
#### Ответ:
```json
{
  "message": "Task deleted successfully"
}
```

---

## Комментарии

### Добавление комментария к задаче
`POST /api/tasks/{task_id}/comments`
#### Описание:
Добавляет комментарий к задаче.
#### Логика:
- Проверяет, существует ли задача с таким ID.
- Проверяет, не является ли комментарий пустым.
- Привязывает комментарий к пользователю и задаче.
#### Тело запроса (JSON):
```json
{
  "content": "Не забудь проверить код перед деплоем"
}
```
#### Ответ (JSON):
```json
{
  "id": 201,
  "task_id": 101,
  "content": "Не забудь проверить код перед деплоем",
  "created_at": "2025-03-19T12:34:56Z"
}
```

### Удаление комментария
`DELETE /api/comments/{id}`
#### Описание:
Удаляет комментарий по его ID.
#### Логика:
- Проверяет, авторизован ли пользователь.
- Проверяет, является ли пользователь владельцем комментария.
- Удаляет комментарий из базы данных.
#### Ответ:
```json
{
  "message": "Comment deleted successfully"
}
```

---

## Уведомления

### Получение уведомлений пользователя
`GET /api/notifications`
#### Описание:
Возвращает список уведомлений для текущего пользователя.
#### Логика:
- Проверяет, авторизован ли пользователь.
- Возвращает список уведомлений, связанных с пользователем.
#### Ответ (JSON):
```json
[
  {
    "id": 301,
    "message": "Ваша задача #101 завершена",
    "read": false
  }
]
```

### Пометка уведомления как прочитанного
`PATCH /api/notifications/{id}`
#### Описание:
Обновляет статус уведомления на "прочитано".
#### Логика:
- Проверяет, авторизован ли пользователь.
- Проверяет, что уведомление принадлежит пользователю.
- Обновляет статус уведомления в базе данных.
#### Ответ:
```json
{
  "id": 301,
  "read": true
}
```

---

Этот API включает логику обработки ошибок, валидации данных и проверки прав доступа для каждого эндпоинта.


### Обновление токена
`POST /api/auth/refresh`
#### Описание:
Обновляет `access_token`, используя `refresh_token`.
#### Логика:
- Проверяет, действителен ли `refresh_token`.
- Генерирует новый `access_token`.
- В случае недействительности `refresh_token` запрашивает повторную аутентификацию.
#### Тело запроса (JSON):
```json
{
  "refresh_token": "refresh_token_here"
}
```
#### Ответ (JSON):
```json
{
  "access_token": "new_access_token_here"
}
```


## Администрирование

### Удаление пользователя администратором
`DELETE /api/users/{id}`
#### Описание:
Удаляет пользователя (доступно только администратору).
#### Логика:
- Проверяет, имеет ли пользователь права администратора.
- Проверяет, существует ли пользователь.
- Если пользователь существует, удаляет его из базы данных.


### Типы уведомлений
- `task_created` – создана новая задача.
- `task_completed` – задача завершена.
- `comment_added` – добавлен новый комментарий.
